# 前端安全之防御CSRF跨站请求伪造

前端安全问题通常有XSS跨站脚本攻击和CSRF跨站请求伪造，上一篇介绍了XSS跨站脚本攻击。本文将研究第二种--CSRF跨站请求伪造 

## 受攻击原因

攻击者在用户已经登入目标网站的情况下，诱使用户访问一个攻击页面，利用目标网站对用户的信任，伪造用户身份在攻击页面对目标网站发起操作的请求，达到攻击目的

举个例子：用户A 对银行发起一个转账请求`http://bank/transfer?amount=1000`，银行服务端保存了用户的登入信息session。攻击者知晓了转账接口，在session尚未过期的这段时间，在自己的网站中放入请求代码并诱导用户A访问带攻击的网站，攻击者此时就会伪造用户身份A发起转账


## 如何防御
* 添加验证码
  给请求添加验证码，强制用户与应用进行交互，可以保证每次都是用户主动发起请求，但给用户的所有的操作都加上验证码，不切合实际

* 验证http请求头中`Referer` 字段
  `Referer`告诉服务器是从哪个页面链接过来的。可以判断Referer地址是否是白名单中的地址，来过滤请求

* 为每一个请求增加一个token值
  比如转账接口`http://bank/transfer?amount=1000&token=XXX`, 每次请求都验证token的合法性。token值根据客户端与服务约定的算法生成，必须保证不可被第三方知晓，且算法必须足够安全

## 总结
CSRF攻击的根本原因是利用目标站点的身份验证机制，身份验证虽然可以保证请求来自符合规定的用户，但不能保证是否是用户本人主动发起的请求。所以要从根本上解决CSRF攻击，必须完善认证机制

  